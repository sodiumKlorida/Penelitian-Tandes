<div class="bg-gray-100 rounded-2xl shadow-md border border-gray-300 p-4 w-80 h-40 flex items-center justify-center">
  <div id="tips-aktivitas" class="text-gray-700 text-sm font-medium leading-snug">Loading...</div>
</div>

<script>
  async function getTips() {
    try {
      // Ambil data AQI & Cuaca
      const [resAqi, resCuaca] = await Promise.all([
        fetch("/aqicn/tandes"),
        fetch("/prakiraan"),
      ]);

      const dataAqi = await resAqi.json();
      const dataCuaca = await resCuaca.json();

      console.log("AQI:", dataAqi);
      console.log("Cuaca:", dataCuaca);

      let tips = "Nikmati hari Anda 👍";

      if (!dataAqi.error && dataAqi.aqi && dataCuaca.prakiraan?.length > 0) {
        const aqi = dataAqi.aqi;
        const cuaca = dataCuaca.prakiraan[0].cuaca?.toLowerCase() || "";

        // Tentukan kategori AQI
        let kondisiUdara = "";
        if (aqi <= 50) kondisiUdara = "baik";
        else if (aqi <= 100) kondisiUdara = "sedang";
        else if (aqi <= 150) kondisiUdara = "tidak sehat untuk kelompok sensitif";
        else if (aqi <= 200) kondisiUdara = "tidak sehat";
        else kondisiUdara = "berbahaya";

        // Logika kombinasi tips
        if (cuaca.includes("hujan") && aqi > 100) {
          tips = "🌧️😷 Hujan & udara kurang sehat. Sebaiknya di rumah saja.";
        } else if (cuaca.includes("hujan")) {
          tips = "🌧️ Sedang hujan. Gunakan jas hujan & batasi aktivitas luar.";
        } else if (cuaca.includes("cerah") && aqi <= 50) {
          tips = "🌞🌱 Cerah & udara bersih. Cocok olahraga di luar.";
        } else if (cuaca.includes("cerah") && aqi > 100) {
          tips = "☀️😷 Cerah tapi udara tidak sehat. Gunakan masker jika keluar.";
        } else if (aqi > 150) {
          tips = "🚫 Udara tidak sehat. Kurangi aktivitas di luar ruangan.";
        } else {
          tips = `Cuaca: ${cuaca}, Udara: ${kondisiUdara}. Tetap jaga kesehatan.`;
        }
      }

      document.getElementById("tips-aktivitas").innerHTML = `
        <strong>Tips Hari Ini:</strong><br>${tips}
      `;
    } catch (err) {
      console.error("Gagal ambil data:", err);
      document.getElementById("tips-aktivitas").innerHTML =
        "⚠️ Gagal memuat tips.";
    }
  }

  getTips();
  setInterval(getTips, 3600000); // update tiap 1 jam
</script>
